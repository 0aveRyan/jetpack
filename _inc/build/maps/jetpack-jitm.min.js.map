{"version":3,"sources":["jetpack-jitm.js"],"names":["jQuery","document","ready","$","templates","default","envelope","html","CTA","message","content","classes","jitm_stats_url","icon","description","url","feature_class","primary","id","setJITMContent","$el","response","template","$template","find","click","$my_template","e","preventDefault","hide","ajax","window","jitm_config","api_root","method","data","replaceWith","each","this","message_path","query","get","_wpnonce","then","length"],"mappings":";AACAA,OAAQC,UAAWC,MAAO,SAAUC,GACnC,GAAIC,IACHC,QAAW,SAAUC,GACpB,GAAIC,GAAO,sCACTD,EAASE,IAAIC,QAAU,qBAAuB,IAC3C,uBAAyBH,EAASI,QAAQC,QAAU,qBAAuBL,EAASM,eAAiB,IAkB1G,OAjBAL,IAAQ,uCAAyCD,EAASI,QAAQG,KAAO,SACzEN,GAAQ,qCACRA,GAAQ,kCACRA,GAAQ,mCAAqCD,EAASI,QAAQD,QAAU,SACnEH,EAASI,QAAQI,aAAgD,KAAjCR,EAASI,QAAQI,cACrDP,GAAQ,yCAA2CD,EAASI,QAAQI,YAAc,UAEnFP,GAAQ,SACHD,EAASE,IAAIC,UACjBF,GAAQ,oCACRA,GAAQ,YAAcD,EAASS,IAAM,4BAA8BT,EAASE,IAAIC,QAAU,kBAAoBH,EAASU,cAAgB,kDAAqDV,EAASE,IAAIS,QAAU,aAAe,IAAO,wEAA0EX,EAASY,GAAK,KAAOZ,EAASE,IAAIC,QAAU,OAC/VF,GAAQ,UAETA,GAAQ,4BAA8BD,EAASU,cAAgB,sCAC/DT,GAAQ,SACRA,GAAQ,SAEDJ,EAAGI,KAIRY,EAAiB,SAAUC,EAAKC,GACnC,GAAIC,IAmBJA,EAAWD,EAASC,WAGClB,EAAWkB,KAC/BA,EAAW,UAGZ,IAAIC,GAAYnB,EAAWkB,GAAYD,EACvCE,GAAUC,KAAM,yBAA0BC,MAzB7B,SAAUC,GACtB,MAAO,UAAUC,GAChBA,EAAEC,iBAEFF,EAAaG,OAEb1B,EAAE2B,MACDf,IAAKgB,OAAOC,YAAYC,SAAW,kBACnCC,OAAQ,OACRC,MACCjB,GAAIG,EAASH,GACbF,cAAeK,EAASL,mBAc6BO,IAEzDH,EAAIgB,YAAab,GAGlBpB,GAAG,yBAA0BkC,KAAM,WAClC,GAAIjB,GAAMjB,EAAGmC,MAETC,EAAenB,EAAIe,KAAM,gBACzBK,EAAQpB,EAAIe,KAAM,QAEtBhC,GAAEsC,IAAKV,OAAOC,YAAYC,SAAW,mBACpCM,aAAcA,EACdC,MAAOA,EACPE,SAAUtB,EAAIe,KAAM,WACjBQ,KAAM,SAAUtB,GAEd,IAAMA,EAASuB,QAAYvB,EAAU,GAAIX,SAK9CS,EAAgBC,EAAKC,EAAU","file":"../jetpack-jitm.min.js","sourcesContent":["/* Do not modify this file directly. It is compiled from other files. */\njQuery( document ).ready( function( $ ) {\n\tvar templates = {\n\t\t'default': function( envelope ) {\n\t\t\tvar html = '<div class=\"jitm-card jitm-banner ' + (\n\t\t\t\t\tenvelope.CTA.message ? 'has-call-to-action' : ''\n\t\t\t\t) + ' is-upgrade-premium ' + envelope.content.classes + '\" data-stats_url=\"' + envelope.jitm_stats_url + '\">';\n\t\t\thtml += '<div class=\"jitm-banner__icon-plan\">' + envelope.content.icon + '</div>';\n\t\t\thtml += '<div class=\"jitm-banner__content\">';\n\t\t\thtml += '<div class=\"jitm-banner__info\">';\n\t\t\thtml += '<div class=\"jitm-banner__title\">' + envelope.content.message + '</div>';\n\t\t\tif ( envelope.content.description && envelope.content.description !== '' ) {\n\t\t\t\thtml += '<div class=\"jitm-banner__description\">' + envelope.content.description + '</div>';\n\t\t\t}\n\t\t\thtml += '</div>';\n\t\t\tif ( envelope.CTA.message ) {\n\t\t\t\thtml += '<div class=\"jitm-banner__action\">';\n\t\t\t\thtml += '<a href=\"' + envelope.url + '\" target=\"_blank\" title=\"' + envelope.CTA.message + '\" data-module=\"' + envelope.feature_class + '\" type=\"button\" class=\"jitm-button is-compact ' + ( envelope.CTA.primary ? 'is-primary' : '' ) + ' jptracks\" data-jptracks-name=\"nudge_click\" data-jptracks-prop=\"jitm-' + envelope.id + '\">' + envelope.CTA.message + '</a>';\n\t\t\t\thtml += '</div>';\n\t\t\t}\n\t\t\thtml += '<a href=\"#\" data-module=\"' + envelope.feature_class + '\" class=\"jitm-banner__dismiss\"></a>';\n\t\t\thtml += '</div>';\n\t\t\thtml += '</div>';\n\n\t\t\treturn $( html );\n\t\t}\n\t};\n\n\tvar setJITMContent = function( $el, response ) {\n\t\tvar template;\n\n\t\tvar render = function( $my_template ) {\n\t\t\treturn function( e ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\t$my_template.hide();\n\n\t\t\t\t$.ajax( {\n\t\t\t\t\turl: window.jitm_config.api_root + 'jetpack/v4/jitm',\n\t\t\t\t\tmethod: 'POST', // using DELETE without permalinks is broken in default nginx configuration\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tid: response.id,\n\t\t\t\t\t\tfeature_class: response.feature_class\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t};\n\t\t};\n\n\t\ttemplate = response.template;\n\n\t\t// if we don't have a template for this version, just use the default template\n\t\tif ( ! template || ! templates[ template ] ) {\n\t\t\ttemplate = 'default';\n\t\t}\n\n\t\tvar $template = templates[ template ]( response );\n\t\t$template.find( '.jitm-banner__dismiss' ).click( render( $template ) );\n\n\t\t$el.replaceWith( $template );\n\t};\n\n\t$( '.jetpack-jitm-message' ).each( function() {\n\t\tvar $el = $( this );\n\n\t\tvar message_path = $el.data( 'message-path' );\n\t\tvar query = $el.data( 'query' );\n\n\t\t$.get( window.jitm_config.api_root + 'jetpack/v4/jitm', {\n\t\t\tmessage_path: message_path,\n\t\t\tquery: query,\n\t\t\t_wpnonce: $el.data( 'nonce' )\n\t\t} ).then( function( response ) {\n\t\t\t// properly handle the case of an empty array or no content set\n\t\t\tif ( 0 === response.length || ! response[ 0 ].content ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// for now, always take the first response\n\t\t\tsetJITMContent( $el, response[ 0 ] );\n\t\t} );\n\t} );\n} );\n"]}